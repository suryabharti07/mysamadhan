<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Data Search</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap">
    <!-- Heroicons for better visuals -->
    <script src="https://cdn.jsdelivr.net/npm/@heroicons/2.1.3/dist/heroicons.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212; /* Darker, more modern background */
        }
        .container-bg {
            background-color: #121212;
        }
        .card-bg {
            background-color: #1e1e1e; /* Slightly lighter than the background for contrast */
        }
        .accent-color {
            background-color: #4CAF50; /* A vibrant green accent for a fresh look */
            color: #ffffff;
        }
        .border-accent {
            border-color: #4CAF50;
        }
        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #resultsContainer, #noResults, #loading, #initialMessage {
            animation: fadeIn 0.5s ease-in-out;
        }
        /* Style the scrollbar */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background-color: #4CAF50;
            border-radius: 4px;
            border: 2px solid #1e1e1e;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background-color: #388E3C;
        }
        /* New result card hover effect */
        .google-result:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }
        /* New loading spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="container-bg min-h-screen flex flex-col items-center p-4">

    <!-- Fixed Header with Search Bar -->
    <header class="fixed top-0 left-0 right-0 z-50 w-full bg-[#1e1e1e] bg-opacity-90 backdrop-filter backdrop-blur-lg border-b border-[#2e2e2e] p-4 shadow-2xl flex items-center justify-center">
        <div class="w-full max-w-4xl flex flex-col sm:flex-row items-center justify-center gap-4">
            <a href="#" class="text-3xl sm:text-4xl font-extrabold text-white mb-2 sm:mb-0 mr-auto hover:text-gray-400 transition-colors duration-200">
                Student Search
            </a>
            <div class="relative w-full group">
                <input type="text" id="searchInput" placeholder="Enter student or father's name..." class="w-full p-4 rounded-full border-2 border-[#2e2e2e] bg-[#2a2a2a] text-gray-200 focus:outline-none focus:ring-4 focus:ring-[#4CAF50] transition-all duration-300 pr-12 text-lg">
                <button id="searchButton" class="absolute right-2 top-1/2 -translate-y-1/2 p-3 rounded-full text-white bg-[#4CAF50] hover:bg-[#388E3C] transition-colors duration-200 shadow-lg group-focus-within:bg-[#388E3C]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
                        <path d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 4.906l3.712 3.713a.75.75 0 0 1-1.06 1.06l-3.713-3.712A8.25 8.25 0 0 1 2.25 10.5Z" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="w-full max-w-6xl px-4 py-8 mt-28">
        <!-- Section for data summary with animated numbers -->
        <div id="dataSummary" class="w-full text-white mb-10 hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 text-center">
                <!-- Total Students Box -->
                <div class="card-bg p-8 rounded-2xl shadow-xl border-2 border-[#2e2e2e] hover:scale-[1.03] transition-transform duration-300 transform-gpu">
                    <h3 class="text-xl text-gray-400 font-semibold uppercase tracking-wider">Total Students</h3>
                    <p id="totalCountDisplay" class="text-5xl md:text-6xl font-extrabold mt-3 text-[#4CAF50]">0</p>
                </div>
                <!-- Raghopur Students Box -->
                <div class="card-bg p-8 rounded-2xl shadow-xl border-2 border-[#2e2e2e] hover:scale-[1.03] transition-transform duration-300 transform-gpu">
                    <h3 class="text-xl text-gray-400 font-semibold uppercase tracking-wider">Raghopur</h3>
                    <p id="raghopurCountDisplay" class="text-5xl md:text-6xl font-extrabold mt-3 text-red-500">0</p>
                </div>
                <!-- Bidupur Students Box -->
                <div class="card-bg p-8 rounded-2xl shadow-xl border-2 border-[#2e2e2e] hover:scale-[1.03] transition-transform duration-300 transform-gpu">
                    <h3 class="text-xl text-gray-400 font-semibold uppercase tracking-wider">Bidupur</h3>
                    <p id="bidupurCountDisplay" class="text-5xl md:text-6xl font-extrabold mt-3 text-blue-500">0</p>
                </div>
            </div>
        </div>

        <!-- Initial Message / Loading Indicator -->
        <div id="loading" class="flex flex-col items-center justify-center text-lg text-gray-400 mt-20">
            <div class="spinner mb-4"></div>
            <span>Loading data from Google Sheet...</span>
        </div>
        <div id="initialMessage" class="text-center text-gray-400 mt-20 hidden">
            <p class="text-3xl mb-4 font-bold text-white">Start your search.</p>
            <p class="text-md">Your results will appear here.</p>
        </div>

        <!-- Results container -->
        <div id="resultsContainer" class="w-full text-white p-4 hidden">
            <!-- Results will be dynamically inserted here -->
        </div>

        <!-- No Results Found Message -->
        <div id="noResults" class="text-center text-red-400 mt-20 hidden">
            <p class="text-4xl font-bold mb-4">No Results Found.</p>
            <p class="text-xl">Sorry, no data matches your search.</p>
        </div>
    </main>
    
    <!-- Full-screen modal for detailed view -->
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-filter backdrop-blur-lg z-50 flex items-center justify-center p-4 hidden">
        <div class="card-bg p-8 rounded-3xl shadow-2xl w-full max-w-7xl h-[90vh] overflow-y-auto text-white relative border border-[#2e2e2e] transform-gpu transition-all duration-300">
            <button id="closeModal" class="absolute top-6 right-6 text-gray-400 hover:text-white transition-colors duration-200 p-2 rounded-full bg-[#2a2a2a] hover:bg-[#3e3e3e]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 id="modalStudentName" class="text-3xl font-bold mb-6 text-center text-[#4CAF50]"></h2>
            <div id="detailTableContainer" class="overflow-x-auto">
                <!-- Detailed table will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Data array to store student information
        let studentData = [];
        let allHeaders = []; // To store the headers from the CSV

        // Google Sheet URLs
        const csvUrls = [
            { url: 'https://docs.google.com/spreadsheets/d/1djUbyANRP1K87Fv7bzB3cWJfPlPHKLCtKrXnye5RilA/export?format=csv&gid=1522639976', location: 'Raghopur' },
            { url: 'https://docs.google.com/spreadsheets/d/1Cb8ruWQi-Us90yFsHD3jMqxvwe1W7pM2ZOsb8eaJr6c/export?format=csv&gid=2007015600', location: 'Bidupur' }
        ];

        // Define groups for data based on column index ranges (A=0, B=1, etc.)
        const DATA_GROUPS = [
            { name: 'Student Details', range: [0, 3] },
            { name: 'Hindi', range: [4, 44] },
            { name: 'English', range: [45, 87] },
            { name: 'Kamal Book', range: [88, 129] },
            { name: 'Counting', range: [130, 139] },
            { name: 'Tables', range: [140, 158] },
            { name: 'Math', range: [159, 162] },
            { name: 'Percentage', range: [169, 169] },
            { name: 'FO', range: [170, 170] },
            { name: 'Extra Information', range: [171, 171] }
        ];

        // Get HTML elements
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resultsContainer = document.getElementById('resultsContainer');
        const loadingIndicator = document.getElementById('loading');
        const initialMessage = document.getElementById('initialMessage');
        const noResultsMessage = document.getElementById('noResults');
        const detailModal = document.getElementById('detailModal');
        const closeModalButton = document.getElementById('closeModal');
        const detailTableContainer = document.getElementById('detailTableContainer');
        const dataSummary = document.getElementById('dataSummary');
        const modalStudentName = document.getElementById('modalStudentName');
        
        // Function to animate numbers
        function animateCount(element, target, duration = 1000) {
            let start = 0;
            const startTime = performance.now();
            
            function updateCount(timestamp) {
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentValue = Math.floor(progress * (target - start) + start);
                element.textContent = currentValue;
                
                if (progress < 1) {
                    requestAnimationFrame(updateCount);
                }
            }
            requestAnimationFrame(updateCount);
        }

        // Function to fetch data from all Google Sheets
        async function fetchStudentData() {
            let combinedData = [];
            let headersLoaded = false;

            try {
                for (const sheet of csvUrls) {
                    const response = await fetch(sheet.url);
                    const csvText = await response.text();
                    const rows = csvText.trim().split('\n').filter(row => row.trim() !== '');

                    // Get headers from the first sheet only
                    if (!headersLoaded) {
                        allHeaders = rows[0].split(',').map(header => header.trim());
                        headersLoaded = true;
                    }
                    
                    // Convert data into an array of objects
                    const data = rows.slice(1).map(row => {
                        const values = row.split(',').map(value => value ? value.trim() : '');
                        const student = {};
                        allHeaders.forEach((header, index) => {
                            student[header] = values[index] ? values[index] : '';
                        });
                        student.sourceLocation = sheet.location; // Add the location to the student object
                        return student;
                    });
                    combinedData = combinedData.concat(data);
                }
                return combinedData;
            } catch (error) {
                console.error("Error fetching data:", error);
                loadingIndicator.innerHTML = `<p class="text-center text-red-400 mt-4">There was an issue loading the data. Please check the URLs or try again.</p>`;
                return [];
            }
        }
        
        // Load data on page load
        window.onload = async () => {
            studentData = await fetchStudentData();
            loadingIndicator.classList.add('hidden'); // Hide loading message
            
            // Show the data summary section immediately
            dataSummary.classList.remove('hidden');

            // Calculate counts and start the animations
            if (studentData.length > 0) {
                const totalCount = studentData.length;
                const raghopurCount = studentData.filter(s => s.sourceLocation === 'Raghopur').length;
                const bidupurCount = studentData.filter(s => s.sourceLocation === 'Bidupur').length;
                
                animateCount(document.getElementById('totalCountDisplay'), totalCount, 1500);
                animateCount(document.getElementById('raghopurCountDisplay'), raghopurCount, 1500);
                animateCount(document.getElementById('bidupurCountDisplay'), bidupurCount, 1500);
            }
        };

        // Event listener for search button click
        searchButton.addEventListener('click', () => {
            performSearch(searchInput.value.trim());
        });
        
        // Event listener for 'Enter' key press in search input
        searchInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                performSearch(this.value.trim());
            }
        });

        // Main search function
        function performSearch(searchTerm) {
            // Hide all sections first
            resultsContainer.classList.add('hidden');
            noResultsMessage.classList.add('hidden');
            initialMessage.classList.add('hidden');
            detailModal.classList.add('hidden'); // Also hide the modal if it's open
            dataSummary.classList.add('hidden'); // Hide the summary on search

            if (searchTerm === '') {
                initialMessage.classList.remove('hidden');
                dataSummary.classList.remove('hidden'); // Show summary again if search is cleared
                return;
            }

            loadingIndicator.classList.remove('hidden');
            resultsContainer.innerHTML = '';
            
            setTimeout(() => {
                const foundStudents = studentData.filter(student =>
                    (student['Student Name'] && student['Student Name'].toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (student['Father Name'] && student['Father Name'].toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (student['Extra_Info'] && student['Extra_Info'].toLowerCase().includes(searchTerm.toLowerCase()))
                );

                loadingIndicator.classList.add('hidden');

                if (foundStudents.length > 0) {
                    const resultCards = foundStudents.map((student, index) => {
                        // Determine badge color based on location
                        const badgeColor = student.sourceLocation === 'Raghopur' ? 'bg-red-500' : 'bg-blue-500';

                        return `
                            <div data-index="${index}" class="google-result cursor-pointer card-bg rounded-2xl shadow-lg p-6 relative flex flex-col items-start md:flex-row md:items-center justify-between space-y-4 md:space-y-0 md:space-x-6 transition-all duration-300 transform-gpu border border-[#2e2e2e]">
                                <!-- Location badge at the very top -->
                                <span class="${badgeColor} text-white text-xs font-bold px-3 py-1 rounded-full shadow-md z-10 mb-2">${student.sourceLocation}</span>
                                
                                <!-- Content below the badge, no mt-10 needed -->
                                <div class="w-full flex-1"> 
                                    <!-- Student Name and Father's Name on one line in white -->
                                    <h3 class="text-xl md:text-2xl font-bold text-[#4CAF50]">${student['Student Name']}</h3>
                                    <p class="text-md md:text-lg font-semibold text-gray-300 mt-1">
                                        <span class="font-normal text-gray-400">Father:</span> ${student['Father Name']}
                                    </p>
                                    <!-- Extra Info -->
                                    <p class="text-md md:text-lg font-semibold text-gray-300 mt-2">
                                        <span class="font-normal text-gray-400">Teacher:</span> ${student['Extra_Info']}
                                    </p>
                                </div>
                                <div class="flex-shrink-0 text-right">
                                    <span class="text-sm font-semibold text-gray-400">More Details</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[#4CAF50] ml-2 inline-block">
                                        <path fill-rule="evenodd" d="M3 10a.75.75 0 0 1 .75-.75h10.94l-3.22-3.22a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H3.75A.75.75 0 0 1 3 10Z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        `;
                    }).join('');

                    const resultsHTML = `
                        <p class="text-lg text-gray-400 mb-6">${foundStudents.length} results found.</p>
                        <div class="flex flex-col gap-6">
                            ${resultCards}
                        </div>
                    `;
                    resultsContainer.innerHTML = resultsHTML;
                    resultsContainer.classList.remove('hidden');

                    // Add click event listeners to the new cards
                    document.querySelectorAll('.google-result').forEach(card => {
                        card.addEventListener('click', (event) => {
                            const index = event.currentTarget.dataset.index;
                            // The click event needs to find the student object from the original filtered array
                            const clickedStudent = foundStudents[index];
                            showDetails(clickedStudent);
                        });
                    });

                } else {
                    noResultsMessage.classList.remove('hidden');
                }
            }, 500);
        }

        // Function to show full details in a modal
        function showDetails(student) {
            let detailHTML = '';
            modalStudentName.textContent = student['Student Name'] || 'Details';
            
            DATA_GROUPS.forEach(group => {
                const [startIndex, endIndex] = group.range;
                
                // Create a section for the group if it has any data
                detailHTML += `
                    <h3 class="text-xl font-semibold text-[#4CAF50] mt-6 mb-3">${group.name}</h3>
                    <div class="overflow-x-auto rounded-xl shadow-xl mb-4">
                        <table class="w-full text-left text-sm text-gray-400 border-collapse">
                            <tbody class="divide-y divide-[#2e2e2e]">
                `;

                // Iterate through the columns for the current group using the correct headers
                for (let i = startIndex; i <= endIndex; i++) {
                    const key = allHeaders[i];
                    if (Object.hasOwnProperty.call(student, key)) {
                        detailHTML += `
                            <tr class="bg-[#2a2a2a] hover:bg-[#3e3e3e] transition-colors duration-200">
                                <td class="px-6 py-4 font-bold text-gray-200 whitespace-nowrap">${key}</td>
                                <td class="px-6 py-4">${student[key]}</td>
                            </tr>
                        `;
                    }
                }

                detailHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            });

            // Add a row for the source location
            detailHTML += `
                <h3 class="text-xl font-semibold text-[#4CAF50] mt-6 mb-3">Other Details</h3>
                <div class="overflow-x-auto rounded-xl shadow-xl mb-4">
                    <table class="w-full text-left text-sm text-gray-400 border-collapse">
                        <tbody class="divide-y divide-[#2e2e2e]">
                            <tr class="bg-[#2a2a2a] hover:bg-[#3e3e3e] transition-colors duration-200">
                                <td class="px-6 py-4 font-bold text-gray-200 whitespace-nowrap">Location</td>
                                <td class="px-6 py-4">${student.sourceLocation}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;

            detailTableContainer.innerHTML = detailHTML;
            detailModal.classList.remove('hidden');
        }

        // Event listener to close the modal
        closeModalButton.addEventListener('click', () => {
            detailModal.classList.add('hidden');
        });
        
    </script>
</body>
</html>

